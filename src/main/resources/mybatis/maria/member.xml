<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.jhta_2402_2_final.dao.MemberDao">
    <!-- INSERT 쿼리 for USERS 테이블 -->
    <insert id="insertUser" parameterType="MemberDto" useGeneratedKeys="true" keyProperty="userUid">
        INSERT INTO USER (user_uid, user_name, user_pw, user_id, user_email, user_tel)
        VALUES (UUID(), #{userName}, #{userPassword}, #{userId}, #{userEmail}, #{userTel})
    </insert>

    <!-- INSERT 쿼리 for ROLE 테이블 -->
    <insert id="insertRole" parameterType="MemberDto">
        INSERT INTO USER_ROLE (user_role_uid, user_uid, role_uid)
        VALUES (
        UUID(),
        (SELECT user_uid FROM USER WHERE user_id = #{userId}),
        (SELECT role_uid FROM ROLE WHERE role_name = #{role})
        )
    </insert>

    <select id="selectUserWithRole" parameterType="String" resultType="MemberDto">
        SELECT
        u.user_uid as userUid,
        u.user_name as userName,
        u.user_pw as userPassword,
        u.user_id as userId,
        u.user_email as userEmail,
        r.role_name as roleName
        FROM USER u
        LEFT JOIN USER_ROLE a ON u.user_uid = a.user_uid
        LEFT JOIN ROLE r ON a.role_uid = r.role_uid
        WHERE u.user_id = #{userId}
    </select>
</mapper>