<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.jhta_2402_2_final.dao.distribution.KitOrderProcessDao">
    <select id="findAllOrder" resultType="Map">
        SELECT
            KO.KIT_ORDER_ID AS 'kitOrderID',
                KC.NAME AS 'kitCompanyName',
                M.NAME AS 'kitName',
                M.PRICE AS 'kitPrice',
                KO.QUANTITY AS 'quantity',
                KO.QUANTITY * M.PRICE AS 'totalPrice',
                KO.PRODUCT_ORDER_DATE AS 'kitOrderDate',
                S.STATUS AS 'status'
        FROM
            KIT_ORDER KO
                JOIN
            KIT_COMPANY KC ON KO.KIT_COMPANY_ID = KC.KIT_COMPANY_ID
                JOIN
            MEALKIT M ON KO.MEALKIT_ID = M.MEALKIT_ID
                JOIN
            STATUS S ON KO.STATUS_ID = S.STATUS_ID;
    </select>

    <select id="findKitRecipe" resultType="Map">
        SELECT
            S.NAME AS 재료명,
            KS.QUANTITY AS 필요수량
        FROM
            KIT_ORDER KO
                JOIN
            KIT_SOURCE KS ON KO.MEALKIT_ID = KS.MEALKIT_ID
                JOIN
            SOURCE S ON KS.SOURCE_ID = S.SOURCE_ID
        WHERE
            KO.KIT_ORDER_ID LIKE CONCAT(#{kitOrderId}, '%')
    </select>



    <insert id="requestKitSourceOrder" parameterType="KitOrderProcessDto">
        INSERT INTO KIT_ORDER_PROCESS (
            KIT_ORDER_ID,
            KIT_COMPANY_NAME,
            KIT_NAME,
            QUANTITY,
            ORDER_DATE,
            STATUS
        ) VALUES (
                     #{kitOrderUid},
                     #{kitCompanyName},
                     #{kitName},
                     #{quantity},
                     #{kitOrderDate},
                     #{status}
                 )
    </insert>

    <select id="findOrdersByKeyword" parameterType="String" resultType="Map">
        SELECT
            KO.KIT_ORDER_ID AS 'kitOrderID',
                KC.NAME AS 'kitCompanyName',
                M.NAME AS 'kitName',
                KO.QUANTITY AS 'quantity',
                KO.PRODUCT_ORDER_DATE AS 'kitOrderDate',
                S.STATUS AS 'status'
        FROM
            KIT_ORDER KO
                JOIN KIT_COMPANY KC ON KO.KIT_COMPANY_ID = KC.KIT_COMPANY_ID
                JOIN MEALKIT M ON KO.MEALKIT_ID = M.MEALKIT_ID
                JOIN STATUS S ON KO.STATUS_ID = S.STATUS_ID
        WHERE
            M.NAME LIKE CONCAT('%', #{orderKeyword}, '%')
    </select>
</mapper>