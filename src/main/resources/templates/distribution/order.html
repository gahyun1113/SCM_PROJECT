<!DOCTYPE html>
<html lang="en">
<head>
    <th:block th:replace="fragment/adminHeader :: head"></th:block>
</head>
<body>

<th:block th:replace="fragment/adminHeader :: body"></th:block>
<div id="layoutSidenav_content">
    <!-- 페이지마다 다른 콘텐츠 -->
    <main>
        <div class="container-fluid px-4">
            <h1 class="mt-4">Dashboard</h1>

            <div class="card mb-4">
                <div class="card-header">
                    KIT_ORDER 테이블 정보 가져오기
                </div>
                <div class="card-body">

                    <form action="/adminMain" method="get" class="input-group justify-content-end ms-auto mb-3"
                          style="width: 400px;">
                        <select class="datatable-selector" name="category">
                            <option value="All">All</option>
                            <option value="firstName">firstName</option>
                            <option value="lastName">lastName</option>
                            <option value="email">email</option>
                            <option value="department">department</option>
                            <option value="hiredate">hiredate</option>
                        </select>
                        <input type="text" class="form-control" name="keyword" placeholder="Search...">
                        <button type="submit" class="btn btn-primary">검색</button>
                    </form>

                    <table id="datatablesSimple">
                        <thead>
                        <tr>
                            <th>주문ID</th>
                            <th>밀키트 업체ID</th>
                            <th>밀키트 ID</th>
                            <th>밀키트 가격</th>
                            <th>주문 수량</th>
                            <th>주문 날짜</th>
                            <th>상태</th>
                        </tr>
                        </thead>
                        <tfoot>
                        <tr>
                            <th>주문ID</th>
                            <th>밀키트 업체ID</th>
                            <th>밀키트 ID</th>
                            <th>밀키트 가격</th>
                            <th>주문 수량</th>
                            <th>주문 날짜</th>
                            <th>상태</th>
                        </tr>
                        </tfoot>
                        <tbody>
                        <tr th:each="kitOrderDtos : ${kitOrderDtos}">
                            <td th:text="${kitOrderDtos.kitOrderId}"></td>
                            <td th:text="${kitOrderDtos.kitCompanyId}"></td>
                            <td th:text="${kitOrderDtos.mealkitId}"></td>
                            <td th:text="${kitOrderDtos.price}"></td>
                            <td th:text="${kitOrderDtos.quantity}"></td>
                            <td th:text="${kitOrderDtos.orderDate}"></td>
                            <td th:text="${kitOrderDtos.statusId}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </div>

            <div class="card mb-4">
                <div class="card-header">
                    KIT_ORDER 테이블 정보 조인 셀렉 가져오기
                </div>

                <div class="card-body">
                    <table id="datatablesSimple02">
                        <thead>
                        <tr>
                            <th>주문ID</th>
                            <th>밀키트 업체</th>
                            <th>밀키트 이름</th>
                            <th>밀키트 가격</th>
                            <th>주문 수량</th>
                            <th>주문 총합</th>
                            <th>주문 날짜</th>
                            <th>상태</th>
                        </tr>
                        </thead>
                        <tfoot>
                        <tr>
                            <th>주문ID</th>
                            <th>밀키트 업체</th>
                            <th>밀키트 이름</th>
                            <th>밀키트 가격</th>
                            <th>주문 수량</th>
                            <th>주문 총합</th>
                            <th>주문 날짜</th>
                            <th>상태</th>
                        </tr>
                        </tfoot>
                        <tbody>
                        <tr th:each="kitOrderNameDtos : ${kitOrderNameDtos}">
                            <td th:text="${kitOrderNameDtos.kitOrderId}"></td>
                            <td th:text="${kitOrderNameDtos.companyId}"></td>
                            <td th:text="${kitOrderNameDtos.mealkitName}"></td>
                            <td th:text="${kitOrderNameDtos.price}"></td>
                            <td th:text="${kitOrderNameDtos.quantity}"></td>
                            <td th:text="${kitOrderNameDtos.totalPrice}"></td>
                            <td th:text="${kitOrderNameDtos.orderDate}"></td>
                            <td th:text="${kitOrderNameDtos.status}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    KIT_ORDER 밀키트 재료 정보 가져오기
                </div>
                <div class="card-body">

                    <form action="/adminMain" method="get" class="input-group justify-content-end ms-auto mb-3"
                          style="width: 400px;">
                        <select class="datatable-selector" name="category">
                            <option value="All">All</option>
                            <option value="firstName">firstName</option>
                            <option value="lastName">lastName</option>
                            <option value="email">email</option>
                            <option value="department">department</option>
                            <option value="hiredate">hiredate</option>
                        </select>
                        <input type="text" class="form-control" name="keyword" placeholder="Search...">
                        <button type="submit" class="btn btn-primary">검색</button>
                    </form>

                    <table id="datatablesSimple03">
                        <thead>
                        <tr>
                            <th>주문ID</th>
                            <th>밀키트 이름</th>
                            <th>재료ID</th>
                            <th>재료명</th>
                            <th>재료 수량</th>
                        </tr>
                        </thead>
                        <tfoot>
                        <tr>
                            <th>주문ID</th>
                            <th>밀키트 이름</th>
                            <th>재료ID</th>
                            <th>재료명</th>
                            <th>재료 수량</th>
                        </tr>
                        </tfoot>
                        <tbody>
                        <tr th:each="kitOrderSourceNameDtos : ${kitOrderSourceNameDtos}">
                            <td th:text="${kitOrderSourceNameDtos.kitOrderId}"></td>
                            <td th:text="${kitOrderSourceNameDtos.mealkitName}"></td>
                            <td th:text="${kitOrderSourceNameDtos.sourceId}"></td>
                            <td th:text="${kitOrderSourceNameDtos.sourceName}"></td>
                            <td th:text="${kitOrderSourceNameDtos.quantity}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    밀키트 재료 주문하기
                </div>
                <div class="card-body">

                    <!-- 검색 폼 -->
                    <form action="/adminMain" method="get" class="input-group justify-content-end ms-auto mb-3" style="width: 400px;">
                        <select class="datatable-selector" name="category">
                            <option value="All">All</option>
                            <option value="firstName">firstName</option>
                            <option value="lastName">lastName</option>
                            <option value="email">email</option>
                            <option value="department">department</option>
                            <option value="hiredate">hiredate</option>
                        </select>
                        <input type="text" class="form-control" name="keyword" placeholder="Search...">
                        <button type="submit" class="btn btn-primary">검색</button>
                    </form>

                    <!-- 데이터 테이블 -->
                    <table id="datatablesSimple04">
                        <thead>
                        <tr>
                            <th>주문ID</th>
                            <th>밀키트</th>
                            <th>주문 수량</th>
                            <th>재료명</th>
                            <th>총 주문해야 하는 재료 개수</th>
                            <th>재료 최저가</th>
                            <th>재료 최저가 판매업체</th>
                            <th>주문하기</th>
                        </tr>
                        </thead>
                        <tfoot>
                        <tr>
                            <th>주문ID</th>
                            <th>밀키트</th>
                            <th>주문 수량</th>
                            <th>재료명</th>
                            <th>총 주문해야 하는 재료 개수</th>
                            <th>재료 최저가</th>
                            <th>재료 최저가 판매업체</th>
                            <th>주문하기</th>
                        </tr>
                        </tfoot>
                        <tbody>
                        <tr th:each="minPriceSourceDto : ${minPriceSourceDtos}">
                            <td th:text="${minPriceSourceDto.kitOrderId}"></td>
                            <td th:text="${minPriceSourceDto.mealkitName}"></td>
                            <td th:text="${minPriceSourceDto.mealkitQuantity}"></td>
                            <td th:text="${minPriceSourceDto.sourceName}"></td>
                            <td th:text="${minPriceSourceDto.totalQuantity}"></td>
                            <td th:text="${minPriceSourceDto.sourcePrice}"></td>
                            <td th:text="${minPriceSourceDto.productCompanyName}"></td>

                            <!-- 주문하기 버튼 -->
                            <td>
                                <form th:action="@{/distribution/sourceOrder}" th:method="post" onsubmit="handleSubmit(event, this);">
                                    <input type="hidden" th:value="${minPriceSourceDto.kitOrderId}" name="kitOrderId"/>
                                    <input type="hidden" th:value="${minPriceSourceDto.sourceId}" name="sourceId"/>
                                    <input type="hidden" th:value="${minPriceSourceDto.productCompanyId}" name="productCompanyId"/>
                                    <input type="hidden" th:value="${minPriceSourceDto.totalQuantity}" name="totalQuantity"/>
                                    <input type="hidden" th:value="${minPriceSourceDto.sourcePrice}" name="sourcePrice"/>
                                    <button type="submit" class="btn btn-primary">주문</button>
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>

        <!-- footer.html 파일을 포함합니다 -->
        <th:block th:replace="fragment/adminFooter :: footer"></th:block>

        <script>
            function handleSubmit(event, form) {
                event.preventDefault(); // 폼의 기본 제출 동작을 방지합니다.

                const submitButton = form.querySelector("button[type='submit']");
                submitButton.disabled = true;
                submitButton.innerText = "주문 처리 중...";

                fetch(form.action, {
                    method: form.method,
                    body: new FormData(form),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
                        // 성공적으로 제출되었을 때의 처리
                        alert("주문이 성공적으로 처리되었습니다!");
                    })
                    .catch(error => {
                        console.error(error);
                        // 오류가 발생한 경우 버튼을 다시 활성화합니다.
                        submitButton.disabled = false;
                        submitButton.innerText = "주문";
                        alert("주문 처리 중 오류가 발생했습니다.");
                    });
            }
        </script>
</body>
</html>