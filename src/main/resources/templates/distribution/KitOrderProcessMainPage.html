<!DOCTYPE html>
<html lang="en">
<head>
    <th:block th:replace="fragment/adminHeader :: head"></th:block>
</head>


<th:block th:replace="fragment/adminHeader :: body"></th:block>
<div id="layoutSidenav_content">
    <!-- 페이지마다 다른 콘텐츠 -->
    <main>
        <div class="container-fluid px-4">
            <h1 class="mt-4">밀키트 주문 목록</h1>
            <ol class="breadcrumb mb-4">
                <li class="breadcrumb-item active">XX개의 새로운 밀키트 재료 요청이 있습니다.</li>
            </ol>

            <!--주문 들어온 밀키트 관련 테이블-->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-table me-1"></i>
                    밀키트 필요 재료 발주
                </div>
                <div class="card-body">

                    <form action="/adminMain" method="get" class="input-group justify-content-end ms-auto mb-3" style="width: 400px;">
                        <select class="datatable-selector" name="category">
                            <option value="All">All</option>
                            <option value="firstName">firstName</option>
                            <option value="lastName">lastName</option>
                            <option value="email">email</option>
                            <option value="department">department</option>
                        </select>
                        <input type="text" class="form-control" name="keyword" placeholder="Search...">
                        <button type="submit" class="btn btn-primary">검색</button>
                    </form>




                    <table id="datatablesSimple">
                        <thead>
                        <tr>
                            <th>주문번호</th>
                            <th>밀키트 회사명</th>
                            <th>밀키트이름</th>
                            <th>밀키트 가격</th>
                            <th>주문개수</th>
                            <th>총 예상 판매가</th>
                            <th>주문일자</th>
                            <th>진행상태</th>
                            <th>재료발주넣기</th>
                        </tr>
                        </thead>

                        <!--tbody > tr > td-->
                        <tbody>
                        <tr th:each=" kitOrderProcess : ${kitOrderList}" >

                            <td th:text="${#strings.substring(kitOrderProcess.kitOrderID, 0, 8)}"></td>
                            <td th:text="${kitOrderProcess.kitCompanyName}"></td>
                            <td th:text="${kitOrderProcess.kitName}"></td>
                            <td th:text="${kitOrderProcess.kitPrice}"></td>
                            <td th:text="${kitOrderProcess.quantity}"></td>
                            <td th:text="${kitOrderProcess.totalPrice}"></td>
                            <td th:text="${#dates.format(kitOrderProcess.kitOrderDate, 'yyyy-MM-dd HH:mm:ss')}"></td>
                            <td th:text="${kitOrderProcess.status}"></td>
                            <!--<td>
                                 삭제
                                <form th:action="@{/adminMain/delete/{id}(id=${emp.id})}" method="post">
                                    <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                                </form>
                            </td>-->
                            <td>
                                <button type="button" class="btn btn-info btn-sm"
                                        data-bs-toggle="modal"
                                        data-bs-target="#empModal">
                                        <!--th:attr="data-id=${emp.id}, data-firstname=${emp.firstName}, data-lastname=${emp.lastName}, data-email=${emp.email}, data-department=${emp.department}, data-hiredate=${emp.hireDate}">-->
                                    재료발주넣기
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="d-flex justify-content-end">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">추가</button>
            </div>



            <!-- 재료 발주 받아 전달 준비가 된 것들 보이는 테이블-->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-table me-1"></i>
                    창고에서 물건 빼서 밀키트 회사에 보내주기
                </div>
                <div class="card-body">

                    <form action="/adminMain" method="get" class="input-group justify-content-end ms-auto mb-3" style="width: 400px;">
                        <select class="datatable-selector" name="category">
                            <option value="All">All</option>
                            <option value="firstName">firstName</option>
                            <option value="lastName">lastName</option>
                            <option value="email">email</option>
                            <option value="department">department</option>
                        </select>
                        <input type="text" class="form-control" name="keyword" placeholder="Search...">
                        <button type="submit" class="btn btn-primary">검색</button>
                    </form>




                    <table id="datatablesSimple02">
                        <thead>
                        <tr>
                            <th>주문번호</th>
                            <th>밀키트 회사명</th>
                            <th>밀키트이름</th>
                            <th>밀키트 가격</th>
                            <th>주문개수</th>
                            <th>총 예상 판매가</th>
                            <th>주문일자</th>
                            <th>진행상태</th>
                            <th>재료 보내기</th>
                        </tr>
                        </thead>

                        <!--tbody > tr > td-->
                        <tbody>
                        <tr th:each=" kitOrderProcess : ${kitOrderList}" >

                            <td th:text="${#strings.substring(kitOrderProcess.kitOrderID, 0, 8)}"></td>
                            <td th:text="${kitOrderProcess.kitCompanyName}"></td>
                            <td th:text="${kitOrderProcess.kitName}"></td>
                            <td th:text="${kitOrderProcess.kitPrice}"></td>
                            <td th:text="${kitOrderProcess.quantity}"></td>
                            <td th:text="${kitOrderProcess.totalPrice}"></td>
                            <td th:text="${#dates.format(kitOrderProcess.kitOrderDate, 'yyyy-MM-dd HH:mm:ss')}"></td>
                            <td th:text="${kitOrderProcess.status}"></td>
                            <!--<td>
                                 삭제
                                <form th:action="@{/adminMain/delete/{id}(id=${emp.id})}" method="post">
                                    <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                                </form>
                            </td>-->
                            <td>
                                <button type="button" class="btn btn-info btn-sm"
                                        data-bs-toggle="modal"
                                        data-bs-target="#empModal">
                                    <!--th:attr="data-id=${emp.id}, data-firstname=${emp.firstName}, data-lastname=${emp.lastName}, data-email=${emp.email}, data-department=${emp.department}, data-hiredate=${emp.hireDate}">-->
                                    재료 출고!
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="d-flex justify-content-end">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">추가</button>
            </div>



        </div>
    </main>
</div>

<!-- 수정 모달 -->
<div class="modal fade" id="empModal" tabindex="-1" aria-labelledby="empModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="employeeForm" th:action="@{/adminMain/update}" th:method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="empModalLabel">Employee Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="modalEmpId" class="form-label">ID</label>
                        <input type="text" class="form-control" id="modalEmpId" name="id" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="modalEmpFirstName" class="form-label">First Name</label>
                        <input type="text" class="form-control" id="modalEmpFirstName" name="firstName">
                    </div>
                    <div class="mb-3">
                        <label for="modalEmpLastName" class="form-label">Last Name</label>
                        <input type="text" class="form-control" id="modalEmpLastName" name="lastName">
                    </div>
                    <div class="mb-3">
                        <label for="modalEmpEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="modalEmpEmail" name="email">
                    </div>
                    <div class="mb-3">
                        <label for="modalEmpDepartment" class="form-label">Department</label>
                        <input type="text" class="form-control" id="modalEmpDepartment" name="department">
                    </div>
                    <div class="mb-3">
                        <label for="modalEmpHireDate" class="form-label">Hire Date</label>
                        <input type="date" class="form-control" id="modalEmpHireDate" name="hireDate">
                    </div>
                    <!-- CSRF Token -->
                    <!--                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />-->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>


<!-- 추가 모달 -->
<div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-labelledby="addEmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="addEmployeeForm" th:action="@{/adminMain/insert}" th:method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="addEmployeeModalLabel">새 직원 추가</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="addEmpFirstName" class="form-label">First Name</label>
                        <input type="text" class="form-control" id="addEmpFirstName" name="firstName" required>
                    </div>
                    <div class="mb-3">
                        <label for="addEmpLastName" class="form-label">Last Name</label>
                        <input type="text" class="form-control" id="addEmpLastName" name="lastName" required>
                    </div>
                    <div class="mb-3">
                        <label for="addEmpEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="addEmpEmail" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="addEmpDepartment" class="form-label">Department</label>
                        <input type="text" class="form-control" id="addEmpDepartment" name="department" required>
                    </div>
                    <div class="mb-3">
                        <label for="addEmpHireDate" class="form-label">Hire Date</label>
                        <input type="date" class="form-control" id="addEmpHireDate" name="hireDate" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>









<!-- footer.html 파일을 포함합니다 -->
<th:block th:replace="fragment/adminFooter :: footer"></th:block>

<!-- Script block to generate the URL using Thymeleaf -->

<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', () => {
        const empModal = document.getElementById('empModal');

        if (empModal) {
            empModal.addEventListener('show.bs.modal', event => {
                const button = event.relatedTarget; // 클릭된 버튼
                const empId = button.getAttribute('data-id');
                const empFirstName = button.getAttribute('data-firstname');
                const empLastName = button.getAttribute('data-lastname');
                const empEmail = button.getAttribute('data-email');
                const empDepartment = button.getAttribute('data-department');
                const empHireDate = button.getAttribute('data-hiredate');

                // 폼 필드에 값 설정
                document.getElementById('modalEmpId').value = empId;
                document.getElementById('modalEmpFirstName').value = empFirstName;
                document.getElementById('modalEmpLastName').value = empLastName;
                document.getElementById('modalEmpEmail').value = empEmail;
                document.getElementById('modalEmpDepartment').value = empDepartment;
                document.getElementById('modalEmpHireDate').value = empHireDate;

                // 폼의 action 속성 설정
                const form = document.getElementById('employeeForm');
                form.action = `/adminMain/update`;
            });
        }
    });
</script>


</html>