<!DOCTYPE html>
<html lang="en">
<head>
    <th:block th:replace="fragment/adminHeader :: head"></th:block>
</head>


<th:block th:replace="fragment/adminHeader :: body"></th:block>
<div id="layoutSidenav_content">
    <!-- 페이지마다 다른 콘텐츠 -->
    <main>
        <div class="container-fluid px-4">
            <h1 class="mt-5 mb-5">밀키트 창고</h1>


            <div class="row mb-5">
<!--                <input type="hidden" th:value="${mealkitList}">-->
                <div class="col-xl-6">
                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-chart-area me-1"></i>
                            창고 재고 현황
                        </div>
                        <div class="card-body">
                            <canvas id="myChart" width="100%" height="60"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6">
                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-chart-bar me-1"></i>
                            밀키트별 판매 현황
                        </div>
                        <div class="card-body">
                            <canvas id="myChart02" width="100%" height="60"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-5">
                <div class="card-header">
                    밀키트 업체별 밀키트 재고 확인
                </div>
                <div class="card-body">

                    <form action="/adminMain" method="get" class="input-group justify-content-end ms-auto mb-3" style="width: 400px;">
                        <select class="datatable-selector" name="category">
                            <option value="All">All</option>
                            <option value="firstName">firstName</option>
                            <option value="lastName">lastName</option>
                            <option value="email">email</option>
                            <option value="department">department</option>
                            <option value="hiredate">hiredate</option>
                        </select>
                        <input type="text" class="form-control" name="keyword" placeholder="Search...">
                        <button type="submit" class="btn btn-primary">검색</button>
                    </form>




                    <table id="datatablesSimple">
                        <thead>
                        <tr>
                            <th>번호</th>
                            <th>창고 ID</th>
                            <th>밀키트 업체명</th>
                            <th>밀키트 명</th>
                            <th>재고</th>
                        </tr>
                        </thead>
                        <tfoot>
                        <tr>
                            <th>번호</th>
                            <th>창고 ID</th>
                            <th>밀키트 업체명</th>
                            <th>밀키트 명</th>
                            <th>재고</th>
                        </tr>
                        </tfoot>
                        <!--tbody > tr > td-->
                        <tbody>
                        <tr th:each="storage, iterStat : ${storage}" >
                            <td th:text="${iterStat.count}"></td>
                            <td th:text="${storage.kitStorageId}"></td>
                            <td th:text="${storage.companyName}"></td>
                            <td th:text="${storage.mealkitName}"></td>
                            <td th:text="${storage.quantity}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card mb-5">
                <div class="card-header">
                    처리 완료된 주문 확인
                </div>
                <div class="card-body">

                    <form action="/adminMain" method="get" class="input-group justify-content-end ms-auto mb-3" style="width: 400px;">
                        <select class="datatable-selector" name="category">
                            <option value="All">All</option>
                            <option value="firstName">firstName</option>
                            <option value="lastName">lastName</option>
                            <option value="email">email</option>
                            <option value="department">department</option>
                            <option value="hiredate">hiredate</option>
                        </select>
                        <input type="text" class="form-control" name="keyword" placeholder="Search...">
                        <button type="submit" class="btn btn-primary">검색</button>
                    </form>




                    <table id="datatablesSimple02">
                        <thead>
                        <tr>
                            <th>번호</th>
                            <th>주문 ID</th>
                            <th>밀키트 업체명</th>
                            <th>밀키트명</th>
                            <th>밀키트 가격</th>
                            <th>개수</th>
                            <th>총액</th>
                            <th>주문일자</th>
                        </tr>
                        </thead>
                        <tfoot>
                        <tr>
                            <th>번호</th>
                            <th>주문 ID</th>
                            <th>밀키트 업체명</th>
                            <th>밀키트명</th>
                            <th>밀키트 가격</th>
                            <th>개수</th>
                            <th>총액</th>
                            <th>주문일자</th>
                        </tr>
                        </tfoot>
                        <!--tbody > tr > td-->
                        <tbody>
                        <tr th:each="completed, iterStat : ${allCompleted}" >
                            <td th:text="${iterStat.count}"></td>
                            <td th:text="${completed.kitOrderId}"></td>
                            <td th:text="${completed.companyName}"></td>
                            <td th:text="${completed.mealkitName}"></td>
                            <td th:text="${completed.mealkitPrice}"></td>
                            <td th:text="${completed.quantity}"></td>
                            <td th:text="${completed.total}"></td>
                            <td th:text="${completed.productOrderDate}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>
</div>













<th:block th:replace="fragment/adminFooter :: footer"></th:block>
</body>
</html>

<!--차트1-->
<script th:inline="javascript">

    const kitList = [[${kitTotalQuantity}]];

    // 데이터와 라벨 배열 초기화
    const labels = [];
    const data = [];
    const backgroundColors = [];

    // companyList의 각 항목을 사용하여 라벨, 데이터, 색상 생성
    kitList.forEach(kit => {
        labels.push(kit.mealkitName);  // 회사 이름을 라벨로 사용
        data.push(kit.totalQuantity);  // 임의의 데이터 생성
        backgroundColors.push(getRandomColorWithOpacity(0.5));  // 랜덤 배경색 (불투명)
    });

    // 랜덤 색상을 생성하는 함수 (rgba 형식)
    function getRandomColorWithOpacity(opacity) {
        const r = Math.floor(Math.random() * 256);
        const g = Math.floor(Math.random() * 256);
        const b = Math.floor(Math.random() * 256);
        return `rgba(${r}, ${g}, ${b}, ${opacity})`;
    }



    // 차트 생성
    const ctx = document.getElementById('myChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: '',
                data: data,
                backgroundColor: backgroundColors,
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: {
                    display: false  // 범례를 숨기기
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });



    // 라벨 생성
    const DATA_COUNT = 12;
    const month = [];
    for (let i = 1; i < DATA_COUNT; ++i) {
        month.push(i.toString());
    }

    // companyList의 각 항목을 사용하여 라벨, 데이터 포인트, 색상 생성
    const datasets = mealkitList.map(kit => {


        // 각 회사에 대해 데이터 포인트를 생성 (임의로 생성하거나 실제 데이터를 사용할 수 있음)
        const mealkitDataPoints = Array.from({ length: DATA_COUNT }, () => Math.floor(Math.random() * 500));

        return {
            label: kit.NAME,  // 데이터셋의 라벨
            data: mealkitDataPoints,  // 데이터 포인트
            borderColor: backgroundColors,  // 데이터셋의 색상
            fill: false,
            cubicInterpolationMode: 'monotone',
            tension: 0.4
        };
    });

    // 두 번째 차트 데이터와 설정 정의
    const data02 = {
        labels: month,  // X축 라벨
        datasets: datasets  // 생성된 데이터셋
    };

    // 차트 설정
    const config = {
        type: 'line',
        data: data02,
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: false,
                    text: '밀키트별 판매 현황'
                },
            },
            interaction: {
                intersect: false,
            },
            scales: {
                x: {
                    display: true,
                    title: {
                        display: true,
                        text: '월'
                    }
                },
                y: {
                    display: true,
                    title: {
                        display: true,
                        text: '개수'
                    },
                    suggestedMin: 0,
                    suggestedMax: 500
                }
            }
        },
    };

    const ctx02 = document.getElementById('myChart02').getContext('2d');
    new Chart(ctx02, config);
</script>
